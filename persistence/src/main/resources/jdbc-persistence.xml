<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation=" http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd">

    <bean id="saveUserSql" class="java.lang.String">
        <constructor-arg>
            <value>
                MERGE INTO Q_USERS
                USING DUAL ON (ACCOUNT_ID = :accountId)
                WHEN MATCHED THEN
                UPDATE SET NAME = :name,
                EMAIL = :email,
                PASSWORD = :password,
                IS_ENABLED = :isEnabled
                WHEN NOT MATCHED THEN
                INSERT (ACCOUNT_ID, NAME, EMAIL, PASSWORD, BIRTHDAY, IS_ENABLED)
                VALUES (:accountId, :name, :email, :password, :birthday, :isEnabled)
            </value>
        </constructor-arg>
    </bean>

    <bean id="saveUserRoles" class="java.lang.String">
        <constructor-arg>
            <value>
                <![CDATA[
                     INSERT INTO Q_USERS_ROLES(ACCOUNT_ID, ROLE_ID) VALUES (:accountId, :roleId)
                ]]>
            </value>
        </constructor-arg>
    </bean>

    <bean id="userSequenceNextVal" class="java.lang.String">
        <constructor-arg>
            <value>
                <![CDATA[
                     SELECT USERS_SEQ.nextval FROM DUAL
                ]]>
            </value>
        </constructor-arg>
    </bean>

    <bean id="findUserByEmailSql" class="java.lang.String">
        <constructor-arg>
            <value>
                <![CDATA[
                     SELECT
                         u.account_id
                        ,u.email
                        ,u.password
                        ,u.is_enabled
                        ,u.birthday
                        ,u.name
                     FROM Q_USERS u
                     WHERE u.email = :email
                ]]>
            </value>
        </constructor-arg>
    </bean>

    <bean id="findUserRolesSql" class="java.lang.String">
        <constructor-arg>
            <value>
                <![CDATA[
                     SELECT
                         r.role_id
                        ,r.name
                     FROM Q_ROLES r
                     LEFT JOIN Q_USERS_ROLES ur ON r.role_id = ur.role_id
                     WHERE ur.account_id = :accountId
                ]]>
            </value>
        </constructor-arg>
    </bean>

    <bean id="findAllUsersSql" class="java.lang.String">
        <constructor-arg>
            <value>
                <![CDATA[
                     SELECT
                         u.account_id
                        ,u.email
                        ,u.password
                        ,u.is_enabled
                        ,u.birthday
                        ,u.name
                        ,r.role_id
                        ,r.name as ROLE_NAME
                     FROM Q_USERS u
                     LEFT JOIN Q_USERS_ROLES ur ON u.account_id = ur.account_id
                     LEFT JOIN Q_ROLES r ON ur.role_id = r.role_id
                ]]>
            </value>
        </constructor-arg>
    </bean>

</beans>
